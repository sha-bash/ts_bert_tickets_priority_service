# Сервис приоритизации обращений в техническую поддержку

Данный проект представляет собой сервис для автоматической приоритизации обращений в службу технической поддержки с использованием предобученной модели BERT.

## Описание

Сервис анализирует текст обращения и автоматически определяет его приоритет, что позволяет оптимизировать работу технической поддержки и сократить время обработки важных запросов.

## Подготовка к запуску

### 1. Подготовка модели

Перед началом работы необходимо загрузить или дообучить свою модель в файлах:
- `prioritization.py` или 
- `custom_prioritization.py` 

Для дообучения модели используйте предварительно загруженные данные из директории `ml_service/data/processed`. 
Конфигурация процесса обучения находится в директории `ml_service/app/configs`.

После успешного обучения переместите результирующую модель из `ml_service/app/models/saved_models` в `ml_service/app/models/prioritization_model`.

### 2. Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта со следующими переменными:

```
POSTGRES_USER=
POSTGRES_PASSWORD=
POSTGRES_DB=
REDIS_HOST=
REDIS_PORT=
MODEL_PATH=
```

## Запуск проекта

После загрузки модели и добавления файла с переменными окружения, запустите проект с помощью Docker Compose:

```bash
docker-compose up -d
```

## API-эндпоинты

### 1. Определение приоритета обращения

```
POST /v1/bert_prediction
```

Используется для определения приоритета нового обращения на основе его текста.

**Запрос:**
```json
{
  "text": "Текст обращения с описанием проблемы"
}
```

**Ответ:**
```json
{
  "task_priority": "LABEL_1",
  "priority_score": 0.92
}
```

### 2. Отправка задачи в Celery-очередь

```
POST /v1/bert_prediction_async
```

Отправка задачи в Celery-очередь для фоновой обработки

**Запрос:**
```json
{
  "text": "Текст обращения с описанием проблемы"
}
```

**Ответ:**
```json
{
  "task_id": "Идентификатор задачи",
  "priorstatusity_score": "submitted"
}
```

### 3. Получение результата Celery-задачи

```
GET /result/{task_id}
```

Проверка статуса и получения результата Celery-задачи

### 4. Проверка состояния сервиса

```
GET /status
```

Возвращает информацию о состоянии сервиса и его компонентов.


## Технологии

- FastAPI
- PyTorch
- BERT
- PostgreSQL
- Redis
- Celery
- Docker

## Мониторинг и логирование

Логи доступны через стандартные команды Docker:

```bash
docker-compose logs -f
```

## Требования к системе

- Docker и Docker Compose
- Минимум 4 ГБ ОЗУ для работы модели BERT
- 4 ГБ свободного дискового пространства